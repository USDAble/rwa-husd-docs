# USDable Chain 开发需求文档 - 第 4 章: 技术规格

**文档编号**: [004-4]
**文档版本**: v2.0
**创建时间**: 2025-10-15 14:42 CST
**更新时间**: 2025-10-15 15:35 CST
**文档类型**: Product Requirements Document (PRD)
**所属项目**: USDable Chain 全栈公链开发

---

## 4.1 区块链核心参数

### 4.1.1 网络参数

| 参数名称         | 数值                           | 说明                  |
| ---------------- | ------------------------------ | --------------------- |
| **Chain ID**     | 待定 (Mainnet), 待定 (Testnet) | 链标识符 (需用户确认) |
| **区块时间**     | ≤ 2 秒                         | 平均出块时间          |
| **最终确认时间** | ≤ 6 秒 (3 个区块)              | 交易最终确认时间      |
| **最大区块大小** | 30 MB                          | 单个区块最大容量      |
| **Gas Limit**    | 30,000,000                     | 每个区块的 Gas 上限   |
| **Base Fee**     | 0.000000001 ABLE (1 Gwei)      | 基础 Gas 费用         |
| **最大 TPS**     | ≥ 2,000                        | 理论最大每秒交易数    |

### 4.1.2 共识参数

#### PoS 共识参数

| 参数名称               | 数值         | 说明                     |
| ---------------------- | ------------ | ------------------------ |
| **核心节点最小质押量** | 100,000 ABLE | 成为核心验证者的最小质押 |
| **最大核心节点数量**   | 21           | 初期 21 个核心节点       |
| **区块奖励**           | 10 ABLE      | 每个区块的验证者奖励     |
| **年化通胀率**         | 3%           | 初期通胀率,逐年递减      |
| **Slash 惩罚**         | 10%          | 恶意行为的质押惩罚比例   |
| **解质押周期**         | 21 天        | 质押解锁等待时间         |

#### BFT 共识参数

| 参数名称         | 数值  | 说明                         |
| ---------------- | ----- | ---------------------------- |
| **最小确认数**   | 2/3+1 | BFT 共识所需的最小确认数     |
| **超时时间**     | 1 秒  | 区块提案超时时间             |
| **最大重试次数** | 3     | 区块提案失败后的最大重试次数 |

#### PoR 共识参数

| 参数名称               | 数值       | 说明                     |
| ---------------------- | ---------- | ------------------------ |
| **服务节点最小质押量** | 3,000 ABLE | 成为数据提供者的最小质押 |
| **最小确认数**         | 3          | 数据验证所需的最小确认数 |
| **验证奖励**           | 1 ABLE     | 每次数据验证的奖励       |
| **验证超时**           | 5 分钟     | 数据验证的超时时间       |
| **Slash 惩罚**         | 20%        | 提供虚假数据的惩罚比例   |

#### 节点质押参数

| 节点类型     | 最小质押量  | 说明                             |
| ------------ | ----------- | -------------------------------- |
| **资产节点** | 10,000 ABLE | 托管资产、对接租金回流           |
| **合规节点** | 5,000 ABLE  | 执行 KYC/AML、审核资产合法性     |
| **服务节点** | 3,000 ABLE  | 提供估值、保险、物业、DePIN 数据 |
| **推广节点** | 1,000 ABLE  | 负责投资人和房东拓展             |

---

## 4.2 智能合约规格

### 4.2.1 EVM 兼容性

**兼容版本**: EVM Shanghai (EIP-3855, EIP-3860)

**支持的操作码**:

-   ✅ 所有标准 EVM 操作码
-   ✅ PUSH0 (EIP-3855)
-   ✅ INITCODE 限制 (EIP-3860)
-   ✅ 预编译合约 (0x01-0x09)

**Gas 费用模型**:

```solidity
// 基础操作Gas费用
ADD/SUB/MUL: 3 gas
DIV/MOD: 5 gas
SLOAD: 2,100 gas
SSTORE (新值): 20,000 gas
SSTORE (修改): 5,000 gas
CREATE: 32,000 gas
CALL: 700 gas
```

### 4.2.2 预编译合约

除了标准 EVM 预编译合约外,新增 RWA 专用预编译合约:

| 地址 | 名称             | 功能            | Gas 费用   |
| ---- | ---------------- | --------------- | ---------- |
| 0x0A | zkTLSVerify      | 验证 zkTLS 证明 | 50,000 gas |
| 0x0B | ComplianceCheck  | 快速合规检查    | 10,000 gas |
| 0x0C | NAVCalculator    | 计算资产净值    | 20,000 gas |
| 0x0D | CrossChainVerify | 验证跨链证明    | 30,000 gas |

**示例: zkTLS 验证预编译合约**

```solidity
// 调用预编译合约
function verifyZkTLSProof(bytes memory proof, bytes32 dataHash) internal view returns (bool) {
    address zkTLSVerify = address(0x0A);

    bytes memory input = abi.encode(proof, dataHash);
    bytes memory output = new bytes(32);

    assembly {
        let success := staticcall(
            50000,              // gas
            zkTLSVerify,        // address
            add(input, 32),     // input data
            mload(input),       // input size
            add(output, 32),    // output data
            32                  // output size
        )

        if iszero(success) {
            revert(0, 0)
        }
    }

    return abi.decode(output, (bool));
}
```

---

## 4.3 存储规格

### 4.3.1 状态存储

**存储引擎**: LevelDB + Merkle Patricia Trie

**状态树结构**:

```
StateRoot
├── AccountTrie (账户状态)
│   ├── Balance (余额)
│   ├── Nonce (交易计数)
│   ├── CodeHash (合约代码哈希)
│   └── StorageRoot (存储根)
├── TransactionTrie (交易树)
└── ReceiptTrie (收据树)
```

**存储优化**:

-   ✅ 状态剪枝 (Pruning): 保留最近 128 个区块的状态
-   ✅ 快照 (Snapshot): 每 10,000 个区块创建快照
-   ✅ 压缩 (Compression): 使用 Snappy 压缩算法

### 4.3.2 Archive 节点存储

**存储容量估算**:

| 时间周期 | 区块数量   | 存储容量 (估算) |
| -------- | ---------- | --------------- |
| 1 天     | 43,200     | ~1.3 GB         |
| 1 个月   | 1,296,000  | ~39 GB          |
| 1 年     | 15,552,000 | ~466 GB         |
| 3 年     | 46,656,000 | ~1.4 TB         |

**存储分层**:

-   **热数据** (最近 7 天): SSD 存储
-   **温数据** (7-90 天): HDD 存储
-   **冷数据** (90 天+): 对象存储 (S3/IPFS)

---

## 4.4 网络规格

### 4.4.1 P2P 网络

**协议**: libp2p

**网络拓扑**: Kademlia DHT

**节点发现**:

-   ✅ Bootstrap 节点: 5 个官方节点
-   ✅ DNS 发现: `bootnode.rwachain.io`
-   ✅ DHT 发现: 自动发现邻近节点

**连接参数**:

| 参数名称       | 数值  | 说明                 |
| -------------- | ----- | -------------------- |
| **最大连接数** | 50    | 单个节点的最大连接数 |
| **最小连接数** | 10    | 保持的最小连接数     |
| **连接超时**   | 30 秒 | 建立连接的超时时间   |
| **心跳间隔**   | 15 秒 | 节点间心跳检测间隔   |

### 4.4.2 RPC 接口

**支持的 RPC 方法**:

#### 标准以太坊 RPC (JSON-RPC 2.0)

```json
// eth_* 方法
eth_blockNumber
eth_getBalance
eth_getTransactionCount
eth_sendRawTransaction
eth_call
eth_estimateGas
eth_getBlockByNumber
eth_getTransactionReceipt
eth_getLogs

// net_* 方法
net_version
net_peerCount
net_listening

// web3_* 方法
web3_clientVersion
web3_sha3
```

#### RWA 专用 RPC 方法

```json
// rwa_* 方法
rwa_getAssetMetadata        // 获取资产元数据
rwa_getComplianceStatus     // 获取合规状态
rwa_getDataProof            // 获取数据验证证明
rwa_getBridgeRecord         // 获取跨链桥接记录
rwa_getPoolInfo             // 获取投资池信息
rwa_getValidatorSet         // 获取验证者集合
rwa_getDataProviderSet      // 获取数据提供者集合
```

**RPC 限流**:

| 用户类型     | 请求限制       | 说明       |
| ------------ | -------------- | ---------- |
| **免费用户** | 100 req/min    | 基础限流   |
| **付费用户** | 1,000 req/min  | 高级限流   |
| **企业用户** | 10,000 req/min | 企业级限流 |

---

## 4.5 安全规格

### 4.5.1 密码学标准

**签名算法**: ECDSA (secp256k1)

**哈希算法**: Keccak-256

**密钥派生**: BIP-32, BIP-39, BIP-44

**示例: 密钥派生路径**

```
m/44'/8888'/0'/0/0  // Mainnet第一个账户
m/44'/8889'/0'/0/0  // Testnet第一个账户
```

### 4.5.2 安全审计要求

**审计范围**:

-   ✅ 核心共识代码
-   ✅ 所有智能合约
-   ✅ RPC 接口
-   ✅ P2P 网络层

**审计标准**:

-   ✅ 至少 3 家独立安全公司审计
-   ✅ 通过 OWASP Top 10 检查
-   ✅ 通过 CWE Top 25 检查
-   ✅ 无 Critical 和 High 级别漏洞

**推荐审计公司**:

1. Trail of Bits
2. OpenZeppelin
3. Certik
4. Quantstamp
5. ConsenSys Diligence

---

## 4.6 性能规格

### 4.6.1 性能指标

| 指标名称         | 目标值  | 测量方法             |
| ---------------- | ------- | -------------------- |
| **TPS**          | 1,000+  | 压力测试             |
| **交易确认时间** | 2-6 秒  | 平均确认时间         |
| **Gas 费用**     | <$0.01  | 标准转账费用         |
| **节点同步时间** | <2 小时 | 从创世块同步到最新块 |
| **RPC 响应时间** | <100ms  | P95 响应时间         |
| **网络延迟**     | <500ms  | 全球节点间延迟       |

### 4.6.2 压力测试要求

**测试场景**:

1. **高频交易**: 持续 1 小时,1000+ TPS
2. **大规模合约部署**: 同时部署 100+个合约
3. **跨链桥接**: 同时处理 50+个跨链请求
4. **数据验证**: 同时验证 100+个数据证明

**性能基准**:

```bash
# 使用Locust进行压力测试
locust -f performance_test.py --users 1000 --spawn-rate 100 --run-time 1h
```

---

## 4.7 兼容性规格

### 4.7.1 钱包兼容性

**支持的钱包**:

-   ✅ MetaMask
-   ✅ WalletConnect
-   ✅ Ledger
-   ✅ Trezor
-   ✅ Trust Wallet
-   ✅ Coinbase Wallet

**集成示例 (MetaMask)**:

```javascript
// 添加RWA Chain到MetaMask
async function addRWAChain() {
    await window.ethereum.request({
        method: "wallet_addEthereumChain",
        params: [
            {
                chainId: "0x22B8", // 8888 in hex
                chainName: "RWA Chain",
                nativeCurrency: {
                    name: "RWA",
                    symbol: "RWA",
                    decimals: 18,
                },
                rpcUrls: ["https://rpc.rwachain.io"],
                blockExplorerUrls: ["https://explorer.rwachain.io"],
            },
        ],
    });
}
```

### 4.7.2 开发工具兼容性

**支持的开发工具**:

-   ✅ Hardhat
-   ✅ Foundry
-   ✅ Truffle
-   ✅ Remix
-   ✅ Brownie

**Hardhat 配置示例**:

```javascript
// hardhat.config.js
module.exports = {
    networks: {
        rwachain: {
            url: "https://rpc.rwachain.io",
            chainId: 8888,
            accounts: [process.env.PRIVATE_KEY],
        },
    },
    solidity: {
        version: "0.8.20",
        settings: {
            optimizer: {
                enabled: true,
                runs: 200,
            },
        },
    },
};
```

---

**文档完成**

**上一章节**: [004-3]核心功能模块.md  
**下一章节**: [004-5]业务流程.md  
**返回主索引**: [004]RWA 公链开发需求文档-主索引.md

**版权声明**: 本文档仅供内部使用,未经授权不得外传。
