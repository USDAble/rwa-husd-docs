# RealChain æ¨¡å—å¼€å‘æŒ‡å—

**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025 å¹´ 10 æœˆ 15 æ—¥
**æœ€åæ›´æ–°**: 2025 å¹´ 10 æœˆ 15 æ—¥

> âš ï¸ **é‡è¦å£°æ˜**: æœ¬æ–‡æ¡£ä¸ºæ¦‚å¿µè®¾è®¡ç¤ºä¾‹,ç”¨äºå­¦ä¹ å’Œå‚è€ƒç›®çš„ã€‚
>
> -   **RealChain ä¸æ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„åŒºå—é“¾é¡¹ç›®**
> -   æ–‡æ¡£åŸºäºçœŸå®çš„æŠ€æœ¯æ ˆ(Cosmos SDK, Tendermint)è¿›è¡Œæ¦‚å¿µè®¾è®¡
> -   æ‰€æœ‰ä»£ç ç¤ºä¾‹å’Œé…ç½®å‡ä¸ºæ¦‚å¿µè®¾è®¡ç¤ºä¾‹
> -   æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2025-10-15
> -   æ–‡æ¡£ç”¨é€”: å±•ç¤ºå¦‚ä½•å¼€å‘åŸºäº Cosmos SDK çš„å…¬é“¾åŠå…¶æ‰©å±•æ¨¡å—

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [è‡ªå®šä¹‰æ¨¡å—å¼€å‘æµç¨‹](#è‡ªå®šä¹‰æ¨¡å—å¼€å‘æµç¨‹)
3. [DApp å¼€å‘å’Œé›†æˆæµç¨‹](#dapp-å¼€å‘å’Œé›†æˆæµç¨‹)
4. [é™„å½•](#é™„å½•)

---

## ğŸ“– æ¦‚è¿°

### 1.1 æ–‡æ¡£è¯´æ˜

#### æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£æ—¨åœ¨ä¸º RealChain æ¨¡å—å¼€å‘è€…å’Œ DApp å¼€å‘è€…æä¾›å®Œæ•´çš„æ¨¡å—å¼€å‘æŒ‡å—ã€‚æ–‡æ¡£æ¶µç›–:

-   **æ¨¡å—å¼€å‘**: è‡ªå®šä¹‰æ¨¡å—å¼€å‘æµç¨‹ (ä»¥ RWA æ¨¡å—ä¸ºä¾‹,åŒ…å«èµ„äº§ç®¡ç†ã€åˆè§„æ£€æŸ¥ç­‰ä¸šåŠ¡é€»è¾‘)
-   **DApp é›†æˆ**: DApp å¼€å‘å’Œ SDK é›†æˆæŒ‡å— (CosmJSã€Keplr é’±åŒ…é›†æˆ)

**é‡ç‚¹**: æœ¬æ–‡æ¡£ä¸“æ³¨äº**ä¸šåŠ¡æ¨¡å—å¼€å‘**,åŒ…å« RWA ç›¸å…³å†…å®¹ã€‚å¦‚éœ€äº†è§£å…¬é“¾å¼€å‘åŸºç¡€ (é“¾åˆå§‹åŒ–ã€èŠ‚ç‚¹éƒ¨ç½²ç­‰),è¯·å‚è€ƒ [å…¬é“¾å¼€å‘æŒ‡å—](./Blockchain-Development-Guide.md)ã€‚

#### é€‚ç”¨å¯¹è±¡

| è§’è‰²            | é€‚ç”¨ç« èŠ‚ | æŠ€èƒ½è¦æ±‚                    |
| --------------- | -------- | --------------------------- |
| **æ¨¡å—å¼€å‘è€…**  | ç¬¬ 2 ç«   | Go, Cosmos SDK, ä¸šåŠ¡é€»è¾‘    |
| **DApp å¼€å‘è€…** | ç¬¬ 3 ç«   | JavaScript/TypeScript, Web3 |

#### é˜…è¯»æŒ‡å—

-   **åˆå­¦è€…**: å»ºè®®å…ˆé˜…è¯» [å…¬é“¾å¼€å‘æŒ‡å—](./Blockchain-Development-Guide.md) äº†è§£åŸºç¡€,å†å­¦ä¹ æ¨¡å—å¼€å‘
-   **æœ‰ç»éªŒçš„å¼€å‘è€…**: å¯ç›´æ¥è·³è½¬åˆ°ç›¸å…³ç« èŠ‚
-   **æ¨¡å—å¼€å‘è€…**: é‡ç‚¹é˜…è¯»ç¬¬ 2 ç«  (è‡ªå®šä¹‰æ¨¡å—å¼€å‘)
-   **DApp å¼€å‘è€…**: é‡ç‚¹é˜…è¯»ç¬¬ 3 ç«  (DApp å¼€å‘å’Œé›†æˆ)

#### ç‰ˆæœ¬ä¿¡æ¯

-   **å½“å‰ç‰ˆæœ¬**: v1.0
-   **åˆ›å»ºæ—¥æœŸ**: 2025 å¹´ 10 æœˆ 15 æ—¥
-   **æœ€åæ›´æ–°**: 2025 å¹´ 10 æœˆ 15 æ—¥
-   **ç»´æŠ¤è€…**: RealChain æ ¸å¿ƒå¼€å‘å›¢é˜Ÿ

---

### 1.2 RealChain å…¬é“¾æ¶æ„

#### æ¶æ„æ¦‚è§ˆ

RealChain æ˜¯ä¸€ä¸ªåŸºäº **Cosmos SDK** æ„å»ºçš„æ¨¡å—åŒ–é€šç”¨å…¬é“¾,æ”¯æŒé€šè¿‡æ‰©å±•æ¨¡å—å®ç° RWA (Real World Assets) èµ„äº§ä»£å¸åŒ–ç­‰ä¸šåŠ¡åŠŸèƒ½ã€‚

```
RealChain æ¶æ„
â”œâ”€â”€ Cosmos SDK (æ ¸å¿ƒæ¡†æ¶)
â”‚   â”œâ”€â”€ Tendermint Consensus (å…±è¯†å±‚)
â”‚   â”œâ”€â”€ ABCI (åº”ç”¨å±‚æ¥å£)
â”‚   â””â”€â”€ Core Modules (æ ¸å¿ƒæ¨¡å—)
â”‚       â”œâ”€â”€ x/auth (è´¦æˆ·ç®¡ç†)
â”‚       â”œâ”€â”€ x/bank (ä»£å¸è½¬è´¦)
â”‚       â”œâ”€â”€ x/staking (è´¨æŠ¼)
â”‚       â”œâ”€â”€ x/governance (æ²»ç†)
â”‚       â””â”€â”€ x/distribution (åˆ†é…)
â”‚
â”œâ”€â”€ Custom Modules (è‡ªå®šä¹‰æ¨¡å—)
â”‚   â”œâ”€â”€ x/rwa (RWA èµ„äº§ç®¡ç†) â­
â”‚   â”œâ”€â”€ x/compliance (åˆè§„æ£€æŸ¥) â­
â”‚   â””â”€â”€ x/valuation (èµ„äº§ä¼°å€¼) â­
â”‚
â””â”€â”€ External Integrations (å¤–éƒ¨é›†æˆ)
    â”œâ”€â”€ IBC (è·¨é“¾åè®®)
    â”œâ”€â”€ IPFS (åˆ†å¸ƒå¼å­˜å‚¨)
    â””â”€â”€ Oracles (é¢„è¨€æœº)
```

**è¯´æ˜**: â­ æ ‡è®°çš„æ¨¡å—ä¸º RealChain ç‰¹æœ‰çš„æ‰©å±•æ¨¡å—

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| ç»„ä»¶           | æŠ€æœ¯       | ç‰ˆæœ¬   | ç”¨é€”               |
| -------------- | ---------- | ------ | ------------------ |
| **åŒºå—é“¾æ¡†æ¶** | Cosmos SDK | v0.50+ | å…¬é“¾å¼€å‘æ¡†æ¶       |
| **å…±è¯†æœºåˆ¶**   | Tendermint | v0.38+ | BFT å…±è¯†           |
| **ç¼–ç¨‹è¯­è¨€**   | Go         | 1.21+  | æ™ºèƒ½åˆçº¦å’Œæ¨¡å—å¼€å‘ |
| **è·¨é“¾åè®®**   | IBC        | v8.0+  | è·¨é“¾é€šä¿¡           |
| **åˆ†å¸ƒå¼å­˜å‚¨** | IPFS       | -      | èµ„äº§å…ƒæ•°æ®å­˜å‚¨     |
| **å¼€å‘å·¥å…·**   | Ignite CLI | v28+   | é“¾å¼€å‘è„šæ‰‹æ¶       |

#### RWA æ‰©å±•æ¨¡å—å®šä½

**é‡è¦**: RealChain æ˜¯ä¸€ä¸ª**é€šç”¨å…¬é“¾**,RWA åŠŸèƒ½é€šè¿‡**æ‰©å±•æ¨¡å—**å®ç°,è€Œéæ ¸å¿ƒåŠŸèƒ½ã€‚

**è®¾è®¡ç†å¿µ**:

-   **æ¨¡å—åŒ–**: RWA æ¨¡å—å¯æ’æ‹”,ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
-   **å¯æ‰©å±•**: å¯ä»¥æ·»åŠ å…¶ä»–ä¸šåŠ¡æ¨¡å— (DeFi, NFT, etc.)
-   **äº’æ“ä½œ**: é€šè¿‡ IBC ä¸å…¶ä»– Cosmos é“¾äº’æ“ä½œ

**RWA æ¨¡å—åŠŸèƒ½**:

-   èµ„äº§ä»£å¸åŒ– (Property, Commodity, Bond)
-   åˆè§„æ£€æŸ¥ (KYC/AML)
-   èµ„äº§ä¼°å€¼ (Valuation Oracle)
-   ç”Ÿå‘½å‘¨æœŸç®¡ç† (Issuance, Transfer, Redemption)

---

### 3.1 RWA æ¨¡å—å¼€å‘æµç¨‹ (ä½œä¸ºç¤ºä¾‹)

#### æµç¨‹æ¦‚è¿°

RWA (Real World Assets) æ¨¡å—æ˜¯ RealChain çš„æ‰©å±•æ¨¡å—ç¤ºä¾‹,ç”¨äºç®¡ç†å®ç‰©èµ„äº§çš„ä»£å¸åŒ–ã€‚æœ¬èŠ‚å±•ç¤ºå¦‚ä½•å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ RWA æ¨¡å—ã€‚

**ç›®æ ‡**:

-   å®ç°èµ„äº§ä»£å¸åŒ–åŠŸèƒ½
-   é›†æˆåˆè§„æ£€æŸ¥
-   å®ç°èµ„äº§ç”Ÿå‘½å‘¨æœŸç®¡ç†
-   å‚è€ƒ T-REX (ERC-3643) æ ‡å‡†

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

#### æ¨¡å—è®¾è®¡

##### èµ„äº§ç±»å‹å®šä¹‰

```go
// proto/realchain/rwa/asset.proto
syntax = "proto3";
package realchain.rwa;

option go_package = "realchain/x/rwa/types";

enum AssetType {
  ASSET_TYPE_UNSPECIFIED = 0;
  ASSET_TYPE_PROPERTY = 1;    // æˆ¿åœ°äº§
  ASSET_TYPE_COMMODITY = 2;   // å•†å“
  ASSET_TYPE_BOND = 3;        // å€ºåˆ¸
}

enum AssetStatus {
  ASSET_STATUS_PENDING = 0;    // å¾…å®¡æ ¸
  ASSET_STATUS_ACTIVE = 1;     // æ´»è·ƒ
  ASSET_STATUS_SUSPENDED = 2;  // æš‚åœ
  ASSET_STATUS_RETIRED = 3;    // é€€å¸‚
}

message RWAAsset {
  string id = 1;
  AssetType asset_type = 2;
  string name = 3;
  string description = 4;
  string issuer = 5;
  string total_supply = 6;  // ä½¿ç”¨ string å­˜å‚¨å¤§æ•°
  AssetStatus status = 7;
  string ipfs_hash = 8;     // å…ƒæ•°æ®å­˜å‚¨åœ¨ IPFS
  int64 created_at = 9;
  int64 updated_at = 10;
}
```

##### æ¶ˆæ¯ç±»å‹å®šä¹‰

```go
// proto/realchain/rwa/tx.proto
syntax = "proto3";
package realchain.rwa;

import "cosmos/msg/v1/msg.proto";
import "realchain/rwa/asset.proto";

option go_package = "realchain/x/rwa/types";

service Msg {
  option (cosmos.msg.v1.service) = true;

  rpc IssueAsset(MsgIssueAsset) returns (MsgIssueAssetResponse);
  rpc TransferAsset(MsgTransferAsset) returns (MsgTransferAssetResponse);
  rpc UpdateAssetStatus(MsgUpdateAssetStatus) returns (MsgUpdateAssetStatusResponse);
}

message MsgIssueAsset {
  option (cosmos.msg.v1.signer) = "issuer";

  string issuer = 1;
  AssetType asset_type = 2;
  string name = 3;
  string description = 4;
  string total_supply = 5;
  string ipfs_hash = 6;
}

message MsgIssueAssetResponse {
  string asset_id = 1;
}

message MsgTransferAsset {
  option (cosmos.msg.v1.signer) = "from";

  string from = 1;
  string to = 2;
  string asset_id = 3;
  string amount = 4;
}

message MsgTransferAssetResponse {}

message MsgUpdateAssetStatus {
  option (cosmos.msg.v1.signer) = "issuer";

  string issuer = 1;
  string asset_id = 2;
  AssetStatus new_status = 3;
}

message MsgUpdateAssetStatusResponse {}
```

#### è¯¦ç»†æ­¥éª¤

##### æ­¥éª¤ 1: åˆ›å»º RWA æ¨¡å—éª¨æ¶

```bash
# åˆ›å»º RWA æ¨¡å—
ignite scaffold module rwa

# åˆ›å»ºèµ„äº§å‘è¡Œæ¶ˆæ¯
ignite scaffold message issue-asset \
  asset-type:uint \
  name \
  description \
  total-supply \
  ipfs-hash \
  --module rwa

# åˆ›å»ºèµ„äº§è½¬ç§»æ¶ˆæ¯
ignite scaffold message transfer-asset \
  to \
  asset-id \
  amount \
  --module rwa
```

##### æ­¥éª¤ 2: å®ç° Keeper é€»è¾‘

```go
// x/rwa/keeper/keeper.go
package keeper

import (
    "context"
    "fmt"

    "cosmossdk.io/store/prefix"
    storetypes "cosmossdk.io/store/types"
    "github.com/cosmos/cosmos-sdk/codec"
    sdk "github.com/cosmos/cosmos-sdk/types"

    "realchain/x/rwa/types"
)

type Keeper struct {
    cdc      codec.BinaryCodec
    storeKey storetypes.StoreKey

    // ä¾èµ–å…¶ä»–æ¨¡å—çš„ Keeper
    bankKeeper    types.BankKeeper
    accountKeeper types.AccountKeeper
}

func NewKeeper(
    cdc codec.BinaryCodec,
    storeKey storetypes.StoreKey,
    bankKeeper types.BankKeeper,
    accountKeeper types.AccountKeeper,
) Keeper {
    return Keeper{
        cdc:           cdc,
        storeKey:      storeKey,
        bankKeeper:    bankKeeper,
        accountKeeper: accountKeeper,
    }
}

// IssueAsset å‘è¡Œèµ„äº§
func (k Keeper) IssueAsset(ctx context.Context, msg *types.MsgIssueAsset) (string, error) {
    sdkCtx := sdk.UnwrapSDKContext(ctx)

    // ç”Ÿæˆèµ„äº§ ID
    assetID := fmt.Sprintf("rwa-%d", sdkCtx.BlockHeight())

    // åˆ›å»ºèµ„äº§å¯¹è±¡
    asset := types.RWAAsset{
        Id:          assetID,
        AssetType:   msg.AssetType,
        Name:        msg.Name,
        Description: msg.Description,
        Issuer:      msg.Issuer,
        TotalSupply: msg.TotalSupply,
        Status:      types.AssetStatus_ASSET_STATUS_ACTIVE,
        IpfsHash:    msg.IpfsHash,
        CreatedAt:   sdkCtx.BlockTime().Unix(),
        UpdatedAt:   sdkCtx.BlockTime().Unix(),
    }

    // å­˜å‚¨èµ„äº§
    k.SetAsset(ctx, asset)

    // é“¸é€ ä»£å¸åˆ°å‘è¡Œè€…è´¦æˆ·
    // (è¿™é‡Œç®€åŒ–å¤„ç†,å®é™…åº”è¯¥ä½¿ç”¨ bank æ¨¡å—)

    return assetID, nil
}

// SetAsset å­˜å‚¨èµ„äº§
func (k Keeper) SetAsset(ctx context.Context, asset types.RWAAsset) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.AssetKey)
    b := k.cdc.MustMarshal(&asset)
    store.Set([]byte(asset.Id), b)
}

// GetAsset è·å–èµ„äº§
func (k Keeper) GetAsset(ctx context.Context, id string) (types.RWAAsset, bool) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.AssetKey)
    b := store.Get([]byte(id))
    if b == nil {
        return types.RWAAsset{}, false
    }

    var asset types.RWAAsset
    k.cdc.MustUnmarshal(b, &asset)
    return asset, true
}
```

##### æ­¥éª¤ 3: å®ç°æ¶ˆæ¯å¤„ç†å™¨

```go
// x/rwa/keeper/msg_server.go
package keeper

import (
    "context"

    sdk "github.com/cosmos/cosmos-sdk/types"
    "realchain/x/rwa/types"
)

type msgServer struct {
    Keeper
}

func NewMsgServerImpl(keeper Keeper) types.MsgServer {
    return &msgServer{Keeper: keeper}
}

func (k msgServer) IssueAsset(goCtx context.Context, msg *types.MsgIssueAsset) (*types.MsgIssueAssetResponse, error) {
    ctx := sdk.UnwrapSDKContext(goCtx)

    // éªŒè¯å‘è¡Œè€…æƒé™ (ç®€åŒ–å¤„ç†)
    // å®é™…åº”è¯¥æ£€æŸ¥å‘è¡Œè€…æ˜¯å¦æœ‰æƒé™å‘è¡Œèµ„äº§

    // å‘è¡Œèµ„äº§
    assetID, err := k.Keeper.IssueAsset(goCtx, msg)
    if err != nil {
        return nil, err
    }

    // å‘å‡ºäº‹ä»¶
    ctx.EventManager().EmitEvent(
        sdk.NewEvent(
            "asset_issued",
            sdk.NewAttribute("asset_id", assetID),
            sdk.NewAttribute("issuer", msg.Issuer),
            sdk.NewAttribute("asset_type", msg.AssetType.String()),
        ),
    )

    return &types.MsgIssueAssetResponse{AssetId: assetID}, nil
}
```

#### Mermaid æµç¨‹å›¾

##### èµ„äº§å‘è¡Œæµç¨‹ (Sequence Diagram)

```mermaid
sequenceDiagram
    participant Issuer
    participant CLI
    participant MsgServer
    participant Keeper
    participant Store
    participant IPFS

    Issuer->>IPFS: ä¸Šä¼ èµ„äº§å…ƒæ•°æ®
    IPFS-->>Issuer: è¿”å› IPFS Hash
    Issuer->>CLI: realchaind tx rwa issue-asset
    CLI->>MsgServer: MsgIssueAsset
    MsgServer->>MsgServer: éªŒè¯å‘è¡Œè€…æƒé™
    MsgServer->>Keeper: IssueAsset()
    Keeper->>Keeper: ç”Ÿæˆèµ„äº§ ID
    Keeper->>Keeper: åˆ›å»ºèµ„äº§å¯¹è±¡
    Keeper->>Store: å­˜å‚¨èµ„äº§
    Store-->>Keeper: ç¡®è®¤
    Keeper->>Keeper: é“¸é€ ä»£å¸
    Keeper-->>MsgServer: èµ„äº§ ID
    MsgServer->>MsgServer: å‘å‡ºäº‹ä»¶
    MsgServer-->>CLI: MsgIssueAssetResponse
    CLI-->>Issuer: äº¤æ˜“å“ˆå¸Œ + èµ„äº§ ID
```

##### èµ„äº§çŠ¶æ€è½¬æ¢ (State Diagram)

```mermaid
stateDiagram-v2
    [*] --> PENDING: åˆ›å»ºèµ„äº§
    PENDING --> ACTIVE: å®¡æ ¸é€šè¿‡
    PENDING --> [*]: å®¡æ ¸æ‹’ç»
    ACTIVE --> SUSPENDED: æš‚åœäº¤æ˜“
    SUSPENDED --> ACTIVE: æ¢å¤äº¤æ˜“
    ACTIVE --> RETIRED: èµ„äº§é€€å¸‚
    RETIRED --> [*]
```

#### å‚è€ƒèµ„æº

-   **T-REX (ERC-3643)**: https://github.com/TokenySolutions/T-REX
-   **ERC-3643 æ ‡å‡†**: https://eips.ethereum.org/EIPS/eip-3643
-   **Cosmos SDK æ¨¡å—å¼€å‘**: https://docs.cosmos.network/main/build/building-modules/intro

---

### 3.2 åˆè§„æ¨¡å—å¼€å‘æµç¨‹

#### æµç¨‹æ¦‚è¿°

åˆè§„æ¨¡å—ç”¨äºå®ç° KYC/AML æ£€æŸ¥,ç¡®ä¿èµ„äº§è½¬ç§»ç¬¦åˆç›‘ç®¡è¦æ±‚ã€‚å‚è€ƒ T-REX çš„ ONCHAINID æ ‡å‡†ã€‚

**ç›®æ ‡**:

-   å®ç°é“¾ä¸Šèº«ä»½éªŒè¯
-   é›†æˆ KYC/AML æ£€æŸ¥
-   å®ç°åˆè§„è§„åˆ™å¼•æ“
-   å‚è€ƒ ONCHAINID æ ‡å‡†

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

#### æ¨¡å—è®¾è®¡

##### èº«ä»½ç±»å‹å®šä¹‰

```go
// proto/realchain/compliance/identity.proto
syntax = "proto3";
package realchain.compliance;

option go_package = "realchain/x/compliance/types";

enum IdentityStatus {
  IDENTITY_STATUS_UNVERIFIED = 0;
  IDENTITY_STATUS_PENDING = 1;
  IDENTITY_STATUS_VERIFIED = 2;
  IDENTITY_STATUS_REJECTED = 3;
}

message Identity {
  string address = 1;
  IdentityStatus status = 2;
  string kyc_provider = 3;
  repeated Claim claims = 4;
  int64 verified_at = 5;
  int64 expires_at = 6;
}

message Claim {
  string claim_type = 1;  // e.g., "KYC", "AML", "ACCREDITED_INVESTOR"
  string issuer = 2;
  string data = 3;
  int64 issued_at = 4;
}
```

##### åˆè§„è§„åˆ™å®šä¹‰

```go
// proto/realchain/compliance/rule.proto
syntax = "proto3";
package realchain.compliance;

option go_package = "realchain/x/compliance/types";

message ComplianceRule {
  string asset_id = 1;
  repeated string required_claims = 2;  // å¿…éœ€çš„ Claim ç±»å‹
  string min_holding_period = 3;        // æœ€å°æŒæœ‰æœŸ (ç§’)
  string max_transfer_amount = 4;       // æœ€å¤§è½¬ç§»é‡‘é¢
  bool whitelist_enabled = 5;           // æ˜¯å¦å¯ç”¨ç™½åå•
  repeated string whitelist = 6;        // ç™½åå•åœ°å€
}
```

#### è¯¦ç»†æ­¥éª¤

##### æ­¥éª¤ 1: åˆ›å»ºåˆè§„æ¨¡å—

```bash
# åˆ›å»ºåˆè§„æ¨¡å—
ignite scaffold module compliance

# åˆ›å»ºèº«ä»½æ³¨å†Œæ¶ˆæ¯
ignite scaffold message register-identity \
  kyc-provider \
  --module compliance

# åˆ›å»º Claim æ·»åŠ æ¶ˆæ¯
ignite scaffold message add-claim \
  address \
  claim-type \
  data \
  --module compliance
```

##### æ­¥éª¤ 2: å®ç° Keeper é€»è¾‘

```go
// x/compliance/keeper/keeper.go
package keeper

import (
    "context"
    "fmt"

    "cosmossdk.io/store/prefix"
    storetypes "cosmossdk.io/store/types"
    "github.com/cosmos/cosmos-sdk/codec"
    sdk "github.com/cosmos/cosmos-sdk/types"

    "realchain/x/compliance/types"
)

type Keeper struct {
    cdc      codec.BinaryCodec
    storeKey storetypes.StoreKey
}

func NewKeeper(
    cdc codec.BinaryCodec,
    storeKey storetypes.StoreKey,
) Keeper {
    return Keeper{
        cdc:      cdc,
        storeKey: storeKey,
    }
}

// RegisterIdentity æ³¨å†Œèº«ä»½
func (k Keeper) RegisterIdentity(ctx context.Context, address string, kycProvider string) error {
    identity := types.Identity{
        Address:     address,
        Status:      types.IdentityStatus_IDENTITY_STATUS_PENDING,
        KycProvider: kycProvider,
        Claims:      []types.Claim{},
    }

    k.SetIdentity(ctx, identity)
    return nil
}

// AddClaim æ·»åŠ  Claim
func (k Keeper) AddClaim(ctx context.Context, address string, claim types.Claim) error {
    identity, found := k.GetIdentity(ctx, address)
    if !found {
        return fmt.Errorf("identity not found: %s", address)
    }

    identity.Claims = append(identity.Claims, claim)
    k.SetIdentity(ctx, identity)
    return nil
}

// CheckCompliance æ£€æŸ¥åˆè§„æ€§
func (k Keeper) CheckCompliance(ctx context.Context, from string, to string, assetID string, amount string) error {
    // æ£€æŸ¥å‘é€æ–¹èº«ä»½
    fromIdentity, found := k.GetIdentity(ctx, from)
    if !found || fromIdentity.Status != types.IdentityStatus_IDENTITY_STATUS_VERIFIED {
        return fmt.Errorf("sender identity not verified")
    }

    // æ£€æŸ¥æ¥æ”¶æ–¹èº«ä»½
    toIdentity, found := k.GetIdentity(ctx, to)
    if !found || toIdentity.Status != types.IdentityStatus_IDENTITY_STATUS_VERIFIED {
        return fmt.Errorf("receiver identity not verified")
    }

    // æ£€æŸ¥åˆè§„è§„åˆ™
    rule, found := k.GetComplianceRule(ctx, assetID)
    if found {
        // æ£€æŸ¥å¿…éœ€çš„ Claims
        for _, requiredClaim := range rule.RequiredClaims {
            if !k.hasClaim(fromIdentity, requiredClaim) {
                return fmt.Errorf("sender missing required claim: %s", requiredClaim)
            }
            if !k.hasClaim(toIdentity, requiredClaim) {
                return fmt.Errorf("receiver missing required claim: %s", requiredClaim)
            }
        }

        // æ£€æŸ¥ç™½åå•
        if rule.WhitelistEnabled {
            if !k.isWhitelisted(rule, to) {
                return fmt.Errorf("receiver not in whitelist")
            }
        }
    }

    return nil
}

func (k Keeper) hasClaim(identity types.Identity, claimType string) bool {
    for _, claim := range identity.Claims {
        if claim.ClaimType == claimType {
            return true
        }
    }
    return false
}

func (k Keeper) isWhitelisted(rule types.ComplianceRule, address string) bool {
    for _, addr := range rule.Whitelist {
        if addr == address {
            return true
        }
    }
    return false
}

// SetIdentity å­˜å‚¨èº«ä»½
func (k Keeper) SetIdentity(ctx context.Context, identity types.Identity) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.IdentityKey)
    b := k.cdc.MustMarshal(&identity)
    store.Set([]byte(identity.Address), b)
}

// GetIdentity è·å–èº«ä»½
func (k Keeper) GetIdentity(ctx context.Context, address string) (types.Identity, bool) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.IdentityKey)
    b := store.Get([]byte(address))
    if b == nil {
        return types.Identity{}, false
    }

    var identity types.Identity
    k.cdc.MustUnmarshal(b, &identity)
    return identity, true
}

// SetComplianceRule å­˜å‚¨åˆè§„è§„åˆ™
func (k Keeper) SetComplianceRule(ctx context.Context, rule types.ComplianceRule) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.RuleKey)
    b := k.cdc.MustMarshal(&rule)
    store.Set([]byte(rule.AssetId), b)
}

// GetComplianceRule è·å–åˆè§„è§„åˆ™
func (k Keeper) GetComplianceRule(ctx context.Context, assetID string) (types.ComplianceRule, bool) {
    store := prefix.NewStore(runtime.KVStoreAdapter(k.storeService.OpenKVStore(ctx)), types.RuleKey)
    b := store.Get([]byte(assetID))
    if b == nil {
        return types.ComplianceRule{}, false
    }

    var rule types.ComplianceRule
    k.cdc.MustUnmarshal(b, &rule)
    return rule, true
}
```

#### Mermaid æµç¨‹å›¾

##### KYC éªŒè¯æµç¨‹ (Sequence Diagram)

```mermaid
sequenceDiagram
    participant User
    participant KYCProvider
    participant CLI
    participant ComplianceModule
    participant IdentityStore

    User->>KYCProvider: æäº¤ KYC èµ„æ–™
    KYCProvider->>KYCProvider: éªŒè¯èº«ä»½
    KYCProvider-->>User: éªŒè¯é€šè¿‡
    User->>CLI: realchaind tx compliance register-identity
    CLI->>ComplianceModule: MsgRegisterIdentity
    ComplianceModule->>IdentityStore: åˆ›å»ºèº«ä»½ (PENDING)
    IdentityStore-->>ComplianceModule: ç¡®è®¤
    KYCProvider->>CLI: realchaind tx compliance add-claim
    CLI->>ComplianceModule: MsgAddClaim
    ComplianceModule->>IdentityStore: æ·»åŠ  KYC Claim
    ComplianceModule->>IdentityStore: æ›´æ–°çŠ¶æ€ (VERIFIED)
    IdentityStore-->>ComplianceModule: ç¡®è®¤
    ComplianceModule-->>CLI: æˆåŠŸ
    CLI-->>User: èº«ä»½éªŒè¯å®Œæˆ
```

#### å‚è€ƒèµ„æº

-   **ONCHAINID**: https://github.com/onchain-id/solidity
-   **T-REX Compliance**: https://github.com/TokenySolutions/T-REX/tree/main/contracts/compliance
-   **ERC-735**: https://github.com/ethereum/EIPs/issues/735

---

### 3.3 æ¨¡å—é›†æˆå’Œæµ‹è¯•

#### æµç¨‹æ¦‚è¿°

å°† RWA æ¨¡å—å’Œåˆè§„æ¨¡å—é›†æˆåˆ°ä¸»é“¾,å¹¶è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚

**ç›®æ ‡**:

-   é›†æˆå¤šä¸ªæ¨¡å—
-   å®ç°æ¨¡å—é—´é€šä¿¡
-   ç¼–å†™é›†æˆæµ‹è¯•
-   è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•

**é¢„è®¡æ—¶é—´**: 4-8 å°æ—¶

#### è¯¦ç»†æ­¥éª¤

##### æ­¥éª¤ 1: é›†æˆæ¨¡å—åˆ°ä¸»é“¾

ç¼–è¾‘ `app/app.go`:

```go
import (
    rwakeeper "realchain/x/rwa/keeper"
    rwamodule "realchain/x/rwa"
    rwatypes "realchain/x/rwa/types"

    compliancekeeper "realchain/x/compliance/keeper"
    compliancemodule "realchain/x/compliance"
    compliancetypes "realchain/x/compliance/types"
)

type App struct {
    // ... å…¶ä»– Keeper
    RWAKeeper        rwakeeper.Keeper
    ComplianceKeeper compliancekeeper.Keeper
}

func NewApp(...) *App {
    // ... åˆå§‹åŒ–å…¶ä»– Keeper

    // åˆå§‹åŒ– Compliance Keeper
    app.ComplianceKeeper = compliancekeeper.NewKeeper(
        appCodec,
        keys[compliancetypes.StoreKey],
    )

    // åˆå§‹åŒ– RWA Keeper (ä¾èµ– Compliance Keeper)
    app.RWAKeeper = rwakeeper.NewKeeper(
        appCodec,
        keys[rwatypes.StoreKey],
        app.BankKeeper,
        app.AccountKeeper,
        app.ComplianceKeeper,  // æ³¨å…¥ Compliance Keeper
    )

    // æ³¨å†Œæ¨¡å—
    app.ModuleManager = module.NewManager(
        // ... å…¶ä»–æ¨¡å—
        compliancemodule.NewAppModule(appCodec, app.ComplianceKeeper),
        rwamodule.NewAppModule(appCodec, app.RWAKeeper),
    )

    return app
}
```

##### æ­¥éª¤ 2: ä¿®æ”¹ RWA æ¨¡å—é›†æˆåˆè§„æ£€æŸ¥

ç¼–è¾‘ `x/rwa/keeper/msg_server.go`:

```go
func (k msgServer) TransferAsset(goCtx context.Context, msg *types.MsgTransferAsset) (*types.MsgTransferAssetResponse, error) {
    ctx := sdk.UnwrapSDKContext(goCtx)

    // æ£€æŸ¥åˆè§„æ€§
    err := k.complianceKeeper.CheckCompliance(goCtx, msg.From, msg.To, msg.AssetId, msg.Amount)
    if err != nil {
        return nil, fmt.Errorf("compliance check failed: %w", err)
    }

    // æ‰§è¡Œè½¬ç§»
    // ...

    return &types.MsgTransferAssetResponse{}, nil
}
```

##### æ­¥éª¤ 3: ç¼–å†™é›†æˆæµ‹è¯•

åˆ›å»º `x/rwa/keeper/integration_test.go`:

```go
package keeper_test

import (
    "testing"

    "github.com/stretchr/testify/require"

    keepertest "realchain/testutil/keeper"
    "realchain/x/rwa/keeper"
    "realchain/x/rwa/types"
    compliancetypes "realchain/x/compliance/types"
)

func TestAssetTransferWithCompliance(t *testing.T) {
    k, complianceK, ctx := keepertest.RWAKeeperWithCompliance(t)
    srv := keeper.NewMsgServerImpl(k)

    // 1. æ³¨å†Œèº«ä»½
    alice := "real1alice..."
    bob := "real1bob..."

    err := complianceK.RegisterIdentity(ctx, alice, "kyc-provider-1")
    require.NoError(t, err)

    err = complianceK.RegisterIdentity(ctx, bob, "kyc-provider-1")
    require.NoError(t, err)

    // 2. æ·»åŠ  KYC Claim
    aliceClaim := compliancetypes.Claim{
        ClaimType: "KYC",
        Issuer:    "kyc-provider-1",
        Data:      "verified",
    }
    err = complianceK.AddClaim(ctx, alice, aliceClaim)
    require.NoError(t, err)

    bobClaim := compliancetypes.Claim{
        ClaimType: "KYC",
        Issuer:    "kyc-provider-1",
        Data:      "verified",
    }
    err = complianceK.AddClaim(ctx, bob, bobClaim)
    require.NoError(t, err)

    // 3. æ›´æ–°èº«ä»½çŠ¶æ€ä¸ºå·²éªŒè¯
    aliceIdentity, _ := complianceK.GetIdentity(ctx, alice)
    aliceIdentity.Status = compliancetypes.IdentityStatus_IDENTITY_STATUS_VERIFIED
    complianceK.SetIdentity(ctx, aliceIdentity)

    bobIdentity, _ := complianceK.GetIdentity(ctx, bob)
    bobIdentity.Status = compliancetypes.IdentityStatus_IDENTITY_STATUS_VERIFIED
    complianceK.SetIdentity(ctx, bobIdentity)

    // 4. å‘è¡Œèµ„äº§
    issueMsg := &types.MsgIssueAsset{
        Issuer:      alice,
        AssetType:   types.AssetType_ASSET_TYPE_PROPERTY,
        Name:        "Test Property",
        Description: "Test",
        TotalSupply: "1000000",
        IpfsHash:    "QmTest...",
    }
    issueRes, err := srv.IssueAsset(ctx, issueMsg)
    require.NoError(t, err)

    // 5. è®¾ç½®åˆè§„è§„åˆ™
    rule := compliancetypes.ComplianceRule{
        AssetId:        issueRes.AssetId,
        RequiredClaims: []string{"KYC"},
    }
    complianceK.SetComplianceRule(ctx, rule)

    // 6. è½¬ç§»èµ„äº§ (åº”è¯¥æˆåŠŸ)
    transferMsg := &types.MsgTransferAsset{
        From:    alice,
        To:      bob,
        AssetId: issueRes.AssetId,
        Amount:  "1000",
    }
    _, err = srv.TransferAsset(ctx, transferMsg)
    require.NoError(t, err)

    // 7. å°è¯•è½¬ç§»ç»™æœªéªŒè¯çš„ç”¨æˆ· (åº”è¯¥å¤±è´¥)
    charlie := "real1charlie..."
    transferMsg2 := &types.MsgTransferAsset{
        From:    alice,
        To:      charlie,
        AssetId: issueRes.AssetId,
        Amount:  "1000",
    }
    _, err = srv.TransferAsset(ctx, transferMsg2)
    require.Error(t, err)
    require.Contains(t, err.Error(), "identity not verified")
}
```

è¿è¡Œæµ‹è¯•:

```bash
go test ./x/rwa/keeper/... -v
```

#### å‚è€ƒèµ„æº

-   **Cosmos SDK æ¨¡å—é›†æˆ**: https://docs.cosmos.network/main/build/building-apps/app-go
-   **é›†æˆæµ‹è¯•**: https://docs.cosmos.network/main/build/building-modules/testing

---

## ğŸ“± DApp å¼€å‘å’Œé›†æˆæµç¨‹

### 5.1 SDK é›†æˆæµç¨‹

#### æµç¨‹æ¦‚è¿°

ä½¿ç”¨ CosmJS é›†æˆ RealChain SDK,å®ç°ä¸é“¾çš„äº¤äº’ã€‚

**ç›®æ ‡**:

-   å®‰è£…å’Œé…ç½® CosmJS
-   è¿æ¥åˆ° RealChain èŠ‚ç‚¹
-   å®ç°é’±åŒ…é›†æˆ
-   å‘é€äº¤æ˜“å’ŒæŸ¥è¯¢æ•°æ®

**é¢„è®¡æ—¶é—´**: 2-4 å°æ—¶

#### è¯¦ç»†æ­¥éª¤

##### æ­¥éª¤ 1: å®‰è£… CosmJS

```bash
# åˆ›å»ºæ–°é¡¹ç›®
mkdir realchain-dapp
cd realchain-dapp
npm init -y

# å®‰è£… CosmJS
npm install @cosmjs/stargate @cosmjs/proto-signing @cosmjs/encoding

# å®‰è£… TypeScript (å¯é€‰)
npm install --save-dev typescript @types/node
```

##### æ­¥éª¤ 2: é…ç½® RealChain å®¢æˆ·ç«¯

åˆ›å»º `src/client.ts`:

```typescript
import { SigningStargateClient, StargateClient } from "@cosmjs/stargate";
import { DirectSecp256k1HdWallet } from "@cosmjs/proto-signing";

// RealChain é…ç½®
const RPC_ENDPOINT = "https://rpc.realchain.network:443";
const CHAIN_ID = "realchain-1";
const PREFIX = "real";

// åˆ›å»ºåªè¯»å®¢æˆ·ç«¯
export async function createReadOnlyClient(): Promise<StargateClient> {
    const client = await StargateClient.connect(RPC_ENDPOINT);
    return client;
}

// åˆ›å»ºç­¾åå®¢æˆ·ç«¯
export async function createSigningClient(mnemonic: string): Promise<SigningStargateClient> {
    // ä»åŠ©è®°è¯åˆ›å»ºé’±åŒ…
    const wallet = await DirectSecp256k1HdWallet.fromMnemonic(mnemonic, {
        prefix: PREFIX,
    });

    // è·å–è´¦æˆ·
    const [account] = await wallet.getAccounts();
    console.log("Account address:", account.address);

    // åˆ›å»ºç­¾åå®¢æˆ·ç«¯
    const client = await SigningStargateClient.connectWithSigner(RPC_ENDPOINT, wallet, {
        gasPrice: {
            amount: "0.001",
            denom: "able",
        },
    });

    return client;
}
```

##### æ­¥éª¤ 3: å®ç°åŸºæœ¬æ“ä½œ

åˆ›å»º `src/operations.ts`:

```typescript
import { SigningStargateClient, StargateClient } from "@cosmjs/stargate";
import { coins } from "@cosmjs/proto-signing";

// æŸ¥è¯¢ä½™é¢
export async function getBalance(
    client: StargateClient,
    address: string,
    denom: string = "able"
): Promise<string> {
    const balance = await client.getBalance(address, denom);
    return balance.amount;
}

// å‘é€ä»£å¸
export async function sendTokens(
    client: SigningStargateClient,
    senderAddress: string,
    recipientAddress: string,
    amount: string,
    denom: string = "able"
): Promise<string> {
    const result = await client.sendTokens(
        senderAddress,
        recipientAddress,
        coins(amount, denom),
        "auto"
    );

    return result.transactionHash;
}

// æŸ¥è¯¢äº¤æ˜“
export async function getTransaction(client: StargateClient, txHash: string): Promise<any> {
    const tx = await client.getTx(txHash);
    return tx;
}

// æŸ¥è¯¢åŒºå—é«˜åº¦
export async function getBlockHeight(client: StargateClient): Promise<number> {
    const height = await client.getHeight();
    return height;
}
```

##### æ­¥éª¤ 4: å®ç° RWA æ¨¡å—äº¤äº’

åˆ›å»º `src/rwa.ts`:

```typescript
import { SigningStargateClient } from "@cosmjs/stargate";
import { MsgIssueAsset, MsgTransferAsset } from "./proto/realchain/rwa/tx";

// å‘è¡Œèµ„äº§
export async function issueAsset(
    client: SigningStargateClient,
    issuerAddress: string,
    assetType: number,
    name: string,
    description: string,
    totalSupply: string,
    ipfsHash: string
): Promise<string> {
    const msg = {
        typeUrl: "/realchain.rwa.MsgIssueAsset",
        value: MsgIssueAsset.fromPartial({
            issuer: issuerAddress,
            assetType: assetType,
            name: name,
            description: description,
            totalSupply: totalSupply,
            ipfsHash: ipfsHash,
        }),
    };

    const result = await client.signAndBroadcast(issuerAddress, [msg], "auto");

    if (result.code !== 0) {
        throw new Error(`Transaction failed: ${result.rawLog}`);
    }

    return result.transactionHash;
}

// è½¬ç§»èµ„äº§
export async function transferAsset(
    client: SigningStargateClient,
    fromAddress: string,
    toAddress: string,
    assetId: string,
    amount: string
): Promise<string> {
    const msg = {
        typeUrl: "/realchain.rwa.MsgTransferAsset",
        value: MsgTransferAsset.fromPartial({
            from: fromAddress,
            to: toAddress,
            assetId: assetId,
            amount: amount,
        }),
    };

    const result = await client.signAndBroadcast(fromAddress, [msg], "auto");

    if (result.code !== 0) {
        throw new Error(`Transaction failed: ${result.rawLog}`);
    }

    return result.transactionHash;
}

// æŸ¥è¯¢èµ„äº§
export async function queryAsset(client: StargateClient, assetId: string): Promise<any> {
    const queryClient = client.forceGetQueryClient();
    const response = await queryClient.queryAbci(`/realchain.rwa.Query/Asset`, {
        id: assetId,
    });

    return response;
}
```

##### æ­¥éª¤ 5: å®ç°é’±åŒ…é›†æˆ (Keplr)

åˆ›å»º `src/wallet.ts`:

```typescript
// æ£€æŸ¥ Keplr æ˜¯å¦å®‰è£…
export function isKeplrInstalled(): boolean {
    return typeof window !== "undefined" && !!window.keplr;
}

// è¿æ¥ Keplr é’±åŒ…
export async function connectKeplr(chainId: string): Promise<string> {
    if (!isKeplrInstalled()) {
        throw new Error("Keplr wallet is not installed");
    }

    // è¯·æ±‚è¿æ¥
    await window.keplr.enable(chainId);

    // è·å–è´¦æˆ·
    const offlineSigner = window.keplr.getOfflineSigner(chainId);
    const accounts = await offlineSigner.getAccounts();

    return accounts[0].address;
}

// æ·»åŠ  RealChain åˆ° Keplr
export async function addRealChainToKeplr(): Promise<void> {
    if (!isKeplrInstalled()) {
        throw new Error("Keplr wallet is not installed");
    }

    await window.keplr.experimentalSuggestChain({
        chainId: "realchain-1",
        chainName: "RealChain",
        rpc: "https://rpc.realchain.network:443",
        rest: "https://api.realchain.network:443",
        bip44: {
            coinType: 118,
        },
        bech32Config: {
            bech32PrefixAccAddr: "real",
            bech32PrefixAccPub: "realpub",
            bech32PrefixValAddr: "realvaloper",
            bech32PrefixValPub: "realvaloperpub",
            bech32PrefixConsAddr: "realvalcons",
            bech32PrefixConsPub: "realvalconspub",
        },
        currencies: [
            {
                coinDenom: "ABLE",
                coinMinimalDenom: "able",
                coinDecimals: 6,
            },
        ],
        feeCurrencies: [
            {
                coinDenom: "ABLE",
                coinMinimalDenom: "able",
                coinDecimals: 6,
            },
        ],
        stakeCurrency: {
            coinDenom: "ABLE",
            coinMinimalDenom: "able",
            coinDecimals: 6,
        },
    });
}
```

#### å‚è€ƒèµ„æº

-   **CosmJS æ–‡æ¡£**: https://cosmos.github.io/cosmjs/
-   **Keplr é›†æˆ**: https://docs.keplr.app/

---

### 5.2 DApp å¼€å‘æµç¨‹

#### æµç¨‹æ¦‚è¿°

å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ RWA DApp,åŒ…æ‹¬å‰ç«¯ç•Œé¢å’Œæ™ºèƒ½åˆçº¦äº¤äº’ã€‚

**ç›®æ ‡**:

-   æ­å»ºå‰ç«¯æ¡†æ¶
-   å®ç°èµ„äº§å‘è¡Œç•Œé¢
-   å®ç°èµ„äº§äº¤æ˜“ç•Œé¢
-   é›†æˆé’±åŒ…å’Œç­¾å

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

#### æŠ€æœ¯æ ˆ

| ç»„ä»¶           | æŠ€æœ¯                     | ç”¨é€”     |
| -------------- | ------------------------ | -------- |
| **å‰ç«¯æ¡†æ¶**   | React + TypeScript       | UI å¼€å‘  |
| **çŠ¶æ€ç®¡ç†**   | Redux / Zustand          | çŠ¶æ€ç®¡ç† |
| **UI åº“**      | Material-UI / Ant Design | UI ç»„ä»¶  |
| **åŒºå—é“¾äº¤äº’** | CosmJS                   | é“¾äº¤äº’   |
| **é’±åŒ…é›†æˆ**   | Keplr                    | é’±åŒ…è¿æ¥ |

#### è¯¦ç»†æ­¥éª¤

##### æ­¥éª¤ 1: åˆ›å»º React é¡¹ç›®

```bash
# ä½¿ç”¨ Vite åˆ›å»ºé¡¹ç›®
npm create vite@latest realchain-dapp -- --template react-ts
cd realchain-dapp
npm install

# å®‰è£…ä¾èµ–
npm install @cosmjs/stargate @cosmjs/proto-signing
npm install @mui/material @emotion/react @emotion/styled
npm install zustand
```

##### æ­¥éª¤ 2: åˆ›å»ºé’±åŒ…è¿æ¥ç»„ä»¶

åˆ›å»º `src/components/WalletConnect.tsx`:

```typescript
import React, { useState } from "react";
import { Button, Box, Typography } from "@mui/material";
import { connectKeplr, addRealChainToKeplr } from "../utils/wallet";

export const WalletConnect: React.FC = () => {
    const [address, setAddress] = useState<string>("");
    const [connected, setConnected] = useState<boolean>(false);

    const handleConnect = async () => {
        try {
            // æ·»åŠ  RealChain åˆ° Keplr
            await addRealChainToKeplr();

            // è¿æ¥é’±åŒ…
            const addr = await connectKeplr("realchain-1");
            setAddress(addr);
            setConnected(true);
        } catch (error) {
            console.error("Failed to connect wallet:", error);
        }
    };

    return (
        <Box>
            {!connected ? (
                <Button
                    variant="contained"
                    onClick={handleConnect}
                >
                    Connect Wallet
                </Button>
            ) : (
                <Box>
                    <Typography>Connected: {address}</Typography>
                </Box>
            )}
        </Box>
    );
};
```

##### æ­¥éª¤ 3: åˆ›å»ºèµ„äº§å‘è¡Œç»„ä»¶

åˆ›å»º `src/components/IssueAsset.tsx`:

```typescript
import React, { useState } from "react";
import { TextField, Button, Box, Typography } from "@mui/material";
import { issueAsset } from "../utils/rwa";
import { useWallet } from "../hooks/useWallet";

export const IssueAsset: React.FC = () => {
    const { client, address } = useWallet();
    const [name, setName] = useState("");
    const [description, setDescription] = useState("");
    const [totalSupply, setTotalSupply] = useState("");
    const [ipfsHash, setIpfsHash] = useState("");
    const [txHash, setTxHash] = useState("");

    const handleIssue = async () => {
        if (!client || !address) {
            alert("Please connect wallet first");
            return;
        }

        try {
            const hash = await issueAsset(
                client,
                address,
                1, // ASSET_TYPE_PROPERTY
                name,
                description,
                totalSupply,
                ipfsHash
            );

            setTxHash(hash);
            alert(`Asset issued! TX: ${hash}`);
        } catch (error) {
            console.error("Failed to issue asset:", error);
            alert("Failed to issue asset");
        }
    };

    return (
        <Box>
            <Typography variant="h5">Issue Asset</Typography>
            <TextField
                label="Name"
                value={name}
                onChange={(e) => setName(e.target.value)}
                fullWidth
                margin="normal"
            />
            <TextField
                label="Description"
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                fullWidth
                margin="normal"
            />
            <TextField
                label="Total Supply"
                value={totalSupply}
                onChange={(e) => setTotalSupply(e.target.value)}
                fullWidth
                margin="normal"
            />
            <TextField
                label="IPFS Hash"
                value={ipfsHash}
                onChange={(e) => setIpfsHash(e.target.value)}
                fullWidth
                margin="normal"
            />
            <Button
                variant="contained"
                onClick={handleIssue}
            >
                Issue Asset
            </Button>
            {txHash && <Typography>Transaction Hash: {txHash}</Typography>}
        </Box>
    );
};
```

#### Mermaid æµç¨‹å›¾

##### DApp äº¤äº’æµç¨‹ (Sequence Diagram)

```mermaid
sequenceDiagram
    participant User
    participant DApp
    participant Keplr
    participant RealChain

    User->>DApp: è®¿é—® DApp
    User->>DApp: ç‚¹å‡» "Connect Wallet"
    DApp->>Keplr: è¯·æ±‚è¿æ¥
    Keplr-->>User: è¯·æ±‚æˆæƒ
    User->>Keplr: æˆæƒ
    Keplr-->>DApp: è¿”å›åœ°å€
    DApp-->>User: æ˜¾ç¤ºå·²è¿æ¥

    User->>DApp: å¡«å†™èµ„äº§ä¿¡æ¯
    User->>DApp: ç‚¹å‡» "Issue Asset"
    DApp->>Keplr: è¯·æ±‚ç­¾å
    Keplr-->>User: è¯·æ±‚ç¡®è®¤
    User->>Keplr: ç¡®è®¤ç­¾å
    Keplr-->>DApp: è¿”å›ç­¾å
    DApp->>RealChain: å¹¿æ’­äº¤æ˜“
    RealChain-->>DApp: è¿”å›äº¤æ˜“å“ˆå¸Œ
    DApp-->>User: æ˜¾ç¤ºæˆåŠŸ
```

#### å‚è€ƒèµ„æº

-   **React æ–‡æ¡£**: https://react.dev/
-   **Material-UI**: https://mui.com/
-   **CosmJS ç¤ºä¾‹**: https://github.com/cosmos/cosmjs/tree/main/packages/stargate

---

## ğŸ“š é™„å½•

### 7.1 API å‚è€ƒ

#### REST API

RealChain æä¾›æ ‡å‡†çš„ Cosmos SDK REST API:

| ç«¯ç‚¹                                          | æ–¹æ³• | è¯´æ˜           |
| --------------------------------------------- | ---- | -------------- |
| `/cosmos/bank/v1beta1/balances/{address}`     | GET  | æŸ¥è¯¢è´¦æˆ·ä½™é¢   |
| `/cosmos/tx/v1beta1/txs`                      | POST | å¹¿æ’­äº¤æ˜“       |
| `/cosmos/tx/v1beta1/txs/{hash}`               | GET  | æŸ¥è¯¢äº¤æ˜“       |
| `/cosmos/staking/v1beta1/validators`          | GET  | æŸ¥è¯¢éªŒè¯è€…åˆ—è¡¨ |
| `/realchain/rwa/v1/assets/{id}`               | GET  | æŸ¥è¯¢ RWA èµ„äº§  |
| `/realchain/compliance/v1/identity/{address}` | GET  | æŸ¥è¯¢èº«ä»½ä¿¡æ¯   |

**ç¤ºä¾‹**:

```bash
# æŸ¥è¯¢ä½™é¢
curl https://api.realchain.network/cosmos/bank/v1beta1/balances/real1abc...

# æŸ¥è¯¢ RWA èµ„äº§
curl https://api.realchain.network/realchain/rwa/v1/assets/rwa-12345
```

#### gRPC API

RealChain æä¾› gRPC API (ç«¯å£ 9090):

```bash
# ä½¿ç”¨ grpcurl æŸ¥è¯¢
grpcurl -plaintext localhost:9090 list

# æŸ¥è¯¢ä½™é¢
grpcurl -plaintext \
  -d '{"address":"real1abc..."}' \
  localhost:9090 \
  cosmos.bank.v1beta1.Query/Balance
```

#### å‚è€ƒèµ„æº

-   **Cosmos SDK REST API**: https://docs.cosmos.network/main/build/modules
-   **gRPC æ–‡æ¡£**: https://grpc.io/docs/

---

### 7.2 å¸¸è§é—®é¢˜ (FAQ)

#### å…¬é“¾å¼€å‘ç›¸å…³

**Q: å¦‚ä½•ä¿®æ”¹åŒºå—æ—¶é—´?**

A: ç¼–è¾‘ `~/.realchain/config/config.toml`:

```toml
[consensus]
timeout_commit = "5s"  # ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„åŒºå—æ—¶é—´
```

**Q: å¦‚ä½•å¢åŠ æœ€å¤§ Gas é™åˆ¶?**

A: ç¼–è¾‘ `~/.realchain/config/app.toml`:

```toml
[api]
max-gas-wanted = 10000000  # ä¿®æ”¹æœ€å¤§ Gas
```

**Q: å¦‚ä½•å¯ç”¨ CORS?**

A: ç¼–è¾‘ `~/.realchain/config/config.toml`:

```toml
[rpc]
cors_allowed_origins = ["*"]
```

#### æ¨¡å—å¼€å‘ç›¸å…³

**Q: å¦‚ä½•åœ¨æ¨¡å—é—´å…±äº«æ•°æ®?**

A: é€šè¿‡ Keeper ä¾èµ–æ³¨å…¥:

```go
type Keeper struct {
    bankKeeper    types.BankKeeper
    stakingKeeper types.StakingKeeper
}
```

**Q: å¦‚ä½•å¤„ç†å¤§æ•°?**

A: ä½¿ç”¨ `sdk.Int` æˆ– `sdk.Dec`:

```go
amount := sdk.NewInt(1000000)
price := sdk.NewDec(100)
```

#### èŠ‚ç‚¹è¿ç»´ç›¸å…³

**Q: å¦‚ä½•å¤‡ä»½èŠ‚ç‚¹æ•°æ®?**

A: å¤‡ä»½ `~/.realchain` ç›®å½•:

```bash
tar -czf realchain-backup.tar.gz ~/.realchain
```

**Q: å¦‚ä½•æ¢å¤èŠ‚ç‚¹?**

A: è§£å‹å¤‡ä»½æ–‡ä»¶:

```bash
tar -xzf realchain-backup.tar.gz -C ~/
```

**Q: éªŒè¯è€…è¢« Jail æ€ä¹ˆåŠ?**

A: è¿è¡Œ unjail å‘½ä»¤:

```bash
realchaind tx slashing unjail \
  --from validator \
  --chain-id realchain-1
```

#### DApp å¼€å‘ç›¸å…³

**Q: å¦‚ä½•å¤„ç†äº¤æ˜“å¤±è´¥?**

A: æ£€æŸ¥ `result.code` å’Œ `result.rawLog`:

```typescript
if (result.code !== 0) {
    console.error("Transaction failed:", result.rawLog);
}
```

**Q: å¦‚ä½•ç›‘å¬é“¾ä¸Šäº‹ä»¶?**

A: ä½¿ç”¨ WebSocket è®¢é˜…:

```typescript
const ws = new WebSocket("wss://rpc.realchain.network/websocket");
ws.send(
    JSON.stringify({
        jsonrpc: "2.0",
        method: "subscribe",
        params: ["tm.event='NewBlock'"],
        id: 1,
    })
);
```

---

### 7.3 æ•…éšœæ’æŸ¥æŒ‡å—

#### èŠ‚ç‚¹æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: è¿è¡Œ `realchaind start` åç«‹å³é€€å‡º

**å¯èƒ½åŸå› **:

1. ç«¯å£è¢«å ç”¨
2. åˆ›ä¸–æ–‡ä»¶æŸå
3. æ•°æ®åº“æŸå

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥ç«¯å£
lsof -i :26656
lsof -i :26657

# éªŒè¯åˆ›ä¸–æ–‡ä»¶
realchaind validate-genesis

# é‡ç½®æ•°æ®åº“ (è­¦å‘Š: ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®)
realchaind tendermint unsafe-reset-all
```

#### èŠ‚ç‚¹ä¸åŒæ­¥

**ç—‡çŠ¶**: `catching_up` ä¸€ç›´ä¸º `true`

**å¯èƒ½åŸå› **:

1. ç½‘ç»œè¿æ¥é—®é¢˜
2. Peers é…ç½®é”™è¯¯
3. ç£ç›˜ I/O è¿‡æ…¢

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥ Peers
realchaind status | jq '.SyncInfo.peers'

# æ·»åŠ æ›´å¤š Peers
# ç¼–è¾‘ ~/.realchain/config/config.toml
persistent_peers = "peer1@ip1:26656,peer2@ip2:26656"

# å¯ç”¨çŠ¶æ€åŒæ­¥
[statesync]
enable = true
```

#### äº¤æ˜“å¤±è´¥

**ç—‡çŠ¶**: äº¤æ˜“è¿”å›é”™è¯¯ç 

**å¸¸è§é”™è¯¯**:

| é”™è¯¯ç  | è¯´æ˜       | è§£å†³æ–¹æ¡ˆ       |
| ------ | ---------- | -------------- |
| `5`    | ä½™é¢ä¸è¶³   | æ£€æŸ¥è´¦æˆ·ä½™é¢   |
| `11`   | Out of gas | å¢åŠ  Gas é™åˆ¶  |
| `19`   | äº¤æ˜“å·²å­˜åœ¨ | ç­‰å¾…äº¤æ˜“ç¡®è®¤   |
| `32`   | æœªæˆæƒ     | æ£€æŸ¥ç­¾åè€…æƒé™ |

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æŸ¥è¯¢ä½™é¢
realchaind query bank balances <address>

# å¢åŠ  Gas
realchaind tx ... --gas 200000

# æŸ¥è¯¢äº¤æ˜“çŠ¶æ€
realchaind query tx <tx-hash>
```

#### å†…å­˜ä¸è¶³

**ç—‡çŠ¶**: èŠ‚ç‚¹ OOM (Out of Memory)

**è§£å†³æ–¹æ¡ˆ**:

```bash
# å¢åŠ  swap
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# ä¼˜åŒ–é…ç½®
# ç¼–è¾‘ ~/.realchain/config/config.toml
[mempool]
size = 5000  # å‡å° mempool å¤§å°
cache_size = 10000  # å‡å°ç¼“å­˜å¤§å°
```

---

### 7.4 å‚è€ƒèµ„æºæ±‡æ€»

#### å®˜æ–¹æ–‡æ¡£

| èµ„æº             | é“¾æ¥                             | è¯´æ˜           |
| ---------------- | -------------------------------- | -------------- |
| **Cosmos SDK**   | https://docs.cosmos.network/     | æ ¸å¿ƒæ¡†æ¶æ–‡æ¡£   |
| **Tendermint**   | https://docs.tendermint.com/     | å…±è¯†å¼•æ“æ–‡æ¡£   |
| **IBC Protocol** | https://ibc.cosmos.network/      | è·¨é“¾åè®®æ–‡æ¡£   |
| **CosmJS**       | https://cosmos.github.io/cosmjs/ | JavaScript SDK |
| **Ignite CLI**   | https://docs.ignite.com/         | å¼€å‘å·¥å…·æ–‡æ¡£   |

#### RWA ç›¸å…³æ ‡å‡†

| èµ„æº                 | é“¾æ¥                                        | è¯´æ˜              |
| -------------------- | ------------------------------------------- | ----------------- |
| **T-REX (ERC-3643)** | https://github.com/TokenySolutions/T-REX    | è¯åˆ¸ä»£å¸æ ‡å‡†      |
| **ONCHAINID**        | https://github.com/onchain-id/solidity      | é“¾ä¸Šèº«ä»½æ ‡å‡†      |
| **ERC-735**          | https://github.com/ethereum/EIPs/issues/735 | Claim Holder æ ‡å‡† |

#### æˆåŠŸæ¡ˆä¾‹

| é¡¹ç›®           | é“¾æ¥                    | è¯´æ˜                  |
| -------------- | ----------------------- | --------------------- |
| **Centrifuge** | https://centrifuge.io/  | RWA ä»£å¸åŒ–å¹³å°        |
| **Osmosis**    | https://osmosis.zone/   | Cosmos ç”Ÿæ€ DEX       |
| **Juno**       | https://junonetwork.io/ | CosmWasm æ™ºèƒ½åˆçº¦å¹³å° |

#### ç¤¾åŒºèµ„æº

| èµ„æº               | é“¾æ¥                             | è¯´æ˜         |
| ------------------ | -------------------------------- | ------------ |
| **Cosmos Discord** | https://discord.gg/cosmosnetwork | å®˜æ–¹ Discord |
| **Cosmos Forum**   | https://forum.cosmos.network/    | å®˜æ–¹è®ºå›     |
| **Cosmos GitHub**  | https://github.com/cosmos        | å®˜æ–¹ GitHub  |

#### å¼€å‘å·¥å…·

| å·¥å…·                     | é“¾æ¥                              | è¯´æ˜        |
| ------------------------ | --------------------------------- | ----------- |
| **Keplr Wallet**         | https://www.keplr.app/            | Cosmos é’±åŒ… |
| **Mintscan**             | https://www.mintscan.io/          | åŒºå—æµè§ˆå™¨  |
| **Cosmos SDK Tutorials** | https://tutorials.cosmos.network/ | å®˜æ–¹æ•™ç¨‹    |

---

## ğŸ“ æ–‡æ¡£ç»“æŸ

**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025 å¹´ 10 æœˆ 15 æ—¥
**æœ€åæ›´æ–°**: 2025 å¹´ 10 æœˆ 15 æ—¥

> âš ï¸ **å†æ¬¡æé†’**: æœ¬æ–‡æ¡£ä¸ºæ¦‚å¿µè®¾è®¡ç¤ºä¾‹,ç”¨äºå­¦ä¹ å’Œå‚è€ƒç›®çš„ã€‚RealChain ä¸æ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„åŒºå—é“¾é¡¹ç›®ã€‚æ‰€æœ‰ä»£ç ç¤ºä¾‹å’Œé…ç½®å‡ä¸ºæ¦‚å¿µè®¾è®¡ç¤ºä¾‹ã€‚

**æ–‡æ¡£ç»Ÿè®¡**:

-   æ€»ç« èŠ‚: 7 ç« 
-   æ€»å°èŠ‚: 14 èŠ‚
-   ä»£ç ç¤ºä¾‹: 50+ ä¸ª
-   Mermaid å›¾è¡¨: 6 ä¸ª
-   å‚è€ƒèµ„æº: 30+ ä¸ª

**é€‚ç”¨å¯¹è±¡**:

-   å…¬é“¾å¼€å‘è€…
-   æ¨¡å—å¼€å‘è€…
-   èŠ‚ç‚¹è¿ç»´äººå‘˜
-   DApp å¼€å‘è€…
-   æ²»ç†å‚ä¸è€…

**ä¸‹ä¸€æ­¥å»ºè®®**:

1. ä»ç¬¬ 1 ç« å¼€å§‹,æŒ‰é¡ºåºå­¦ä¹ 
2. åŠ¨æ‰‹å®è·µæ¯ä¸ªä»£ç ç¤ºä¾‹
3. å‚è€ƒå®˜æ–¹æ–‡æ¡£æ·±å…¥å­¦ä¹ 
4. åŠ å…¥ç¤¾åŒºäº¤æµè®¨è®º

**åé¦ˆå’Œè´¡çŒ®**:

-   å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·æäº¤ Issue
-   æ¬¢è¿è´¡çŒ®ä»£ç å’Œæ–‡æ¡£æ”¹è¿›

---

**æ„Ÿè°¢ä½¿ç”¨ RealChain ä¸šåŠ¡å¼€å‘æµç¨‹æŠ€æœ¯æ–‡æ¡£!** ğŸš€
