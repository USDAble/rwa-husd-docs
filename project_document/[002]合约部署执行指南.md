# 合约部署执行指南

**创建时间**: 2025-10-14 10:42:46 CST  
**任务编号**: 002  
**部署网络**: Optimism Mainnet (Chain ID: 10)  
**分支**: test-galahad

---

## 📊 部署状态总览

| 步骤 | 合约名称 | Repo | 部署脚本 | 状态 | 合约地址 |
|------|---------|------|---------|------|---------|
| 1 | SystemConfig | rwa-husd-contracts | DeployCore.s.sol | ✅ 已部署 | 0x3d119D3eC992cACF150F040F255CE5309E3fF66F |
| 2 | UserRegistry | rwa-husd-contracts | DeployCore.s.sol | ✅ 已部署 | 0x3F3C9a258582663113eB4fA7D7d8F0E69e2C3b87 |
| 3 | Treasury | treasury-contracts | Deploy.s.sol | ✅ 已部署 | 0xBd92938E115C9da660c341713f10CF4ed363c8d4 |
| 4 | RedemptionManager | redemption-contracts | DeployOPMainnet.s.sol | ✅ 已部署 | 0xB44CD75945f8321d77A9f906c094cC04737EB80A |
| 5 | TradeContract | rwa-husd-trading | DeployTradeContract.s.sol | ⏳ 待部署 | - |
| 6 | RedemptionStrategy | treasury-contracts | Deploy.s.sol | ⏳ 待部署 | - |
| 7 | PropertyToken (Impl) | rwa-husd-contracts | DeployBusiness.s.sol | ⏳ 待部署 | - |
| 8 | PropertyTokenFactory | rwa-husd-contracts | DeployBusiness.s.sol | ⏳ 待部署 | - |
| 9 | RentCustodyContract | batch-token-transfer | DeployRentCustodyContract.s.sol | ⏳ 待部署 | - |
| 10 | AbleToken | community-coin | deploy-op-mainnet.js | ⏳ 待部署 | - |
| 11 | AbleVesting | community-coin | deploy-op-mainnet.js | ⏳ 待部署 | - |
| 12 | AbleVestingFactory | community-coin | deploy-op-mainnet.js | ⏳ 待部署 | - |

---

## 🎯 待部署合约执行步骤

### 步骤5: 部署 TradeContract

**Repo**: rwa-husd-trading  
**部署脚本**: `script/DeployTradeContract.s.sol`

**部署命令**:
```bash
cd /Users/liudong/web3-material/personal/rwa-husd/rwa-husd-trading
forge script script/DeployTradeContract.s.sol:DeployTradeContract --rpc-url $OP_MAINNET_RPC_URL --broadcast --verify
```

**部署后操作**:
1. 记录 Proxy 地址
2. 更新 `rwa-husd-trading/Contract-ABIs.md`
3. 更新 `rwa-husd-trading/README.md`
4. 更新 `rwa-husd-docs/Deployed-Contracts-Testnet.md`

---

### 步骤6: 部署 RedemptionStrategy

**Repo**: treasury-contracts  
**部署脚本**: `script/Deploy.s.sol`

**部署命令**:
```bash
cd /Users/liudong/web3-material/personal/rwa-husd/treasury-contracts
forge script script/Deploy.s.sol:Deploy --rpc-url $OP_MAINNET_RPC_URL --broadcast --verify
```

**部署后操作**:
1. 记录 Proxy 地址
2. 更新 `treasury-contracts/Contract-ABIs.md`
3. 更新 `treasury-contracts/README.md`
4. 更新 `rwa-husd-docs/Deployed-Contracts-Testnet.md`
5. 在 Treasury 合约中设置 RedemptionStrategy 地址

---

### 步骤7-8: 部署 PropertyToken 和 PropertyTokenFactory

**Repo**: rwa-husd-contracts  
**部署脚本**: `script/DeployBusiness.s.sol`

**部署命令**:
```bash
cd /Users/liudong/web3-material/personal/rwa-husd/rwa-husd-contracts
forge script script/DeployBusiness.s.sol:DeployBusiness --rpc-url $OP_MAINNET_RPC_URL --broadcast --verify
```

**部署后操作**:
1. 记录 PropertyToken 实现合约地址
2. 记录 PropertyTokenFactory Proxy 地址
3. 更新 `rwa-husd-contracts/Contract-ABIs.md`
4. 更新 `rwa-husd-contracts/README.md`
5. 更新 `rwa-husd-contracts/.env`:
   - PROPERTY_TOKEN_IMPLEMENTATION
   - PROPERTY_TOKEN_FACTORY_ADDRESS
6. 更新 `rwa-husd-docs/Deployed-Contracts-Testnet.md`

---

### 步骤9: 部署 RentCustodyContract

**Repo**: batch-token-transfer  
**部署脚本**: `hardhat-contracts/script/DeployRentCustodyContract.s.sol`

**部署命令**:
```bash
cd /Users/liudong/web3-material/personal/rwa-husd/batch-token-transfer/hardhat-contracts
forge script script/DeployRentCustodyContract.s.sol:DeployRentCustodyContract --rpc-url $OP_MAINNET_RPC_URL --broadcast --verify
```

**部署后操作**:
1. 记录 Proxy 地址
2. 更新 `batch-token-transfer/hardhat-contracts/Contract-ABIs.md`
3. 更新 `batch-token-transfer/hardhat-contracts/README.md`
4. 更新 `rwa-husd-docs/Deployed-Contracts-Testnet.md`

---

### 步骤10-12: 部署 AbleToken, AbleVesting, AbleVestingFactory

**Repo**: rwa-real-estate-community-coin-contract  
**部署脚本**: `scripts/deploy-op-mainnet.js`

**部署命令**:
```bash
cd /Users/liudong/web3-material/personal/rwa-husd/rwa-real-estate-community-coin-contract
npx hardhat run scripts/deploy-op-mainnet.js --network optimism
```

**部署后操作**:
1. 记录 AbleToken 地址
2. 记录 AbleVesting 地址
3. 记录 AbleVestingFactory 地址
4. 更新 `rwa-real-estate-community-coin-contract/Contract-ABIs.md`
5. 更新 `rwa-real-estate-community-coin-contract/README.md`
6. 更新 `rwa-husd-docs/Deployed-Contracts-Testnet.md`
7. 调用 AbleVesting 的 `initializeTge()` 函数

---

## 📝 文档更新模板

### Contract-ABIs.md 更新模板

```markdown
## [合约名称]

- **合约地址**: `0x...`
- **部署时间**: 2025-10-14
- **版本**: [版本号]
- **架构**: UUPS代理模式 / 直接部署
- **验证状态**: ✅ 已验证
- **区块链浏览器**: [查看合约](https://optimistic.etherscan.io/address/0x...)
```

### Deployed-Contracts-Testnet.md 更新模板

```markdown
### [序号]. [合约名称]

- **合约地址**: `0x...`
- **版本**: [版本号]
- **部署时间**: 2025-10-14
- **架构**: UUPS代理模式 / 直接部署
- **验证状态**: ✅ 已验证
- **区块链浏览器**: [查看合约](https://optimistic.etherscan.io/address/0x...)
- **来源repo**: [repo名称]
```

---

## ⚠️ 注意事项

1. **部署前检查**:
   - 确认 .env 文件中的 RPC_URL 正确
   - 确认 PRIVATE_KEY 有足够的 ETH 用于 Gas
   - 确认所有依赖合约地址已在 .env 中配置

2. **部署顺序**:
   - 必须严格按照步骤5 → 6 → 7-8 → 9 → 10-12 的顺序部署
   - 每个步骤完成后立即更新文档

3. **验证合约**:
   - 使用 `--verify` 参数自动验证
   - 如果自动验证失败,手动在 Etherscan 上验证

4. **Git 提交**:
   - 每完成2-3个合约部署后提交一次
   - Commit message 格式: `feat: 部署 [合约名称] 到 OP Mainnet`

---

## 🔄 部署进度追踪

### 已完成 (4/12)
- [x] SystemConfig
- [x] UserRegistry
- [x] Treasury
- [x] RedemptionManager

### 待完成 (8/12)
- [ ] TradeContract
- [ ] RedemptionStrategy
- [ ] PropertyToken (Impl)
- [ ] PropertyTokenFactory
- [ ] RentCustodyContract
- [ ] AbleToken
- [ ] AbleVesting
- [ ] AbleVestingFactory

---

**执行指南创建时间**: 2025-10-14 10:42:46 CST  
**下一步**: 按照步骤5开始执行部署

